<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="" xml:lang="">
<head>
  <meta charset="utf-8" />
  <meta name="generator" content="pandoc" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes" />
  <title>access-azure-storage-account-resources-from-postman</title>
  <style>
    html {
      line-height: 1.5;
      font-family: Georgia, serif;
      font-size: 20px;
      color: #1a1a1a;
      background-color: #fdfdfd;
    }
    body {
      margin: 0 auto;
      max-width: 36em;
      padding-left: 50px;
      padding-right: 50px;
      padding-top: 50px;
      padding-bottom: 50px;
      hyphens: auto;
      overflow-wrap: break-word;
      text-rendering: optimizeLegibility;
      font-kerning: normal;
    }
    @media (max-width: 600px) {
      body {
        font-size: 0.9em;
        padding: 1em;
      }
    }
    @media print {
      body {
        background-color: transparent;
        color: black;
        font-size: 12pt;
      }
      p, h2, h3 {
        orphans: 3;
        widows: 3;
      }
      h2, h3, h4 {
        page-break-after: avoid;
      }
    }
    p {
      margin: 1em 0;
    }
    a {
      color: #1a1a1a;
    }
    a:visited {
      color: #1a1a1a;
    }
    img {
      max-width: 100%;
    }
    h1, h2, h3, h4, h5, h6 {
      margin-top: 1.4em;
    }
    h5, h6 {
      font-size: 1em;
      font-style: italic;
    }
    h6 {
      font-weight: normal;
    }
    ol, ul {
      padding-left: 1.7em;
      margin-top: 1em;
    }
    li > ol, li > ul {
      margin-top: 0;
    }
    blockquote {
      margin: 1em 0 1em 1.7em;
      padding-left: 1em;
      border-left: 2px solid #e6e6e6;
      color: #606060;
    }
    code {
      font-family: Menlo, Monaco, 'Lucida Console', Consolas, monospace;
      font-size: 85%;
      margin: 0;
    }
    pre {
      margin: 1em 0;
      overflow: auto;
    }
    pre code {
      padding: 0;
      overflow: visible;
      overflow-wrap: normal;
    }
    .sourceCode {
     background-color: transparent;
     overflow: visible;
    }
    hr {
      background-color: #1a1a1a;
      border: none;
      height: 1px;
      margin: 1em 0;
    }
    table {
      margin: 1em 0;
      border-collapse: collapse;
      width: 100%;
      overflow-x: auto;
      display: block;
      font-variant-numeric: lining-nums tabular-nums;
    }
    table caption {
      margin-bottom: 0.75em;
    }
    tbody {
      margin-top: 0.5em;
      border-top: 1px solid #1a1a1a;
      border-bottom: 1px solid #1a1a1a;
    }
    th {
      border-top: 1px solid #1a1a1a;
      padding: 0.25em 0.5em 0.25em 0.5em;
    }
    td {
      padding: 0.125em 0.5em 0.25em 0.5em;
    }
    header {
      margin-bottom: 4em;
      text-align: center;
    }
    #TOC li {
      list-style: none;
    }
    #TOC a:not(:hover) {
      text-decoration: none;
    }
    code{white-space: pre-wrap;}
    span.smallcaps{font-variant: small-caps;}
    span.underline{text-decoration: underline;}
    div.column{display: inline-block; vertical-align: top; width: 50%;}
    div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
    ul.task-list{list-style: none;}
    .display.math{display: block; text-align: center; margin: 0.5rem auto;}
  </style>
  <!--[if lt IE 9]>
    <script src="//cdnjs.cloudflare.com/ajax/libs/html5shiv/3.7.3/html5shiv-printshiv.min.js"></script>
  <![endif]-->
</head>
<body>
<p><span data-css-15b13by="" aria-hidden="false">Get started</span></p>
<p><span data-css-15b13by="" aria-hidden="false">Log in</span></p>
<p><img src="../../pluralsight.imgix.net/author/lg/7aa57bc1-6266-4719-a497-c3ab18a28f5d.png" alt="Author avatar" class="jsx-3841407315" /></p>
<p>Benney Au</p>
<h1 id="access-azure-storage-account-resources-from-postman">Access Azure Storage Account Resources from Postman</h1>
<h3 id="benney-au">Benney Au</h3>
<ul>
<li><p>Oct 8, 2020</p></li>
<li><p>7 Min read</p></li>
<li><p>8,260 Views</p></li>
<li><p>Oct 8, 2020</p></li>
<li><p><span class="jsx-3759398792" itemprop="timeRequired">7 Min</span> read</p></li>
<li><p>8,260 Views</p></li>
</ul>
<p><span class="jsx-3759398792"></span></p>
<p><span data-css-1997kh1="">Postman</span></p>
<p><span class="jsx-3759398792"></span></p>
<p><span data-css-1997kh1="">Languages, Frameworks, and Tools</span></p>
<p><span class="jsx-3759398792"></span></p>
<p><span data-css-1997kh1="">Developer Testing Tools/Frameworks</span></p>
<p><span class="jsx-3759398792"></span></p>
<p><span data-css-1997kh1="">Developer Tools</span></p>
<p>Introduction</p>
<p>25</p>
<ul>
<li><a href="#module-introduction" class="menu-link">Introduction</a></li>
<li><a href="#module-usingsharedkeystoauthorizetotablestorage" class="menu-link">Using Shared Keys to Authorize to Table Storage</a></li>
<li><a href="#module-usingsharedkeystoauthorizetoblobstorage" class="menu-link">Using Shared Keys to Authorize to Blob Storage</a></li>
<li><a href="#module-conclusion" class="menu-link">Conclusion</a></li>
<li><a href="#top" class="menu-link">Top</a></li>
</ul>
<h2 id="introduction">Introduction</h2>
<p>Azure storage accounts provide low-cost and high-availability data services. The primary way to access these data services is using REST APIs. For your business’ custom REST APIs, you may already be comfortable with using Postman to test, debug and monitor them. It would be convenient if you could stay inside Postman to also interact with your Azure storage account, perhaps to make end to end testing easier or share requests with your team members.</p>
<p>In this guide, you will learn how to use Postman to interact with your storage account. You will set up authentication and then query storage tables and storage blobs. This guide builds on a previous guide, <a href="https://app.pluralsight.com/guides/set-up-postman-and-automatically-add-bearer-tokens">Set Up Postman and Automatically Add Bearer Tokens</a>.</p>
<h2 id="using-shared-keys-to-authorize-to-table-storage">Using Shared Keys to Authorize to Table Storage</h2>
<p>Azure storage accounts offer several ways to authenticate, including managed identity for storage blobs and storage queues, Azure AD authentication, shared keys, and shared access signatures (SAS) tokens. However, the simplest solution is using shared keys. Two keys are provided for you when you create a storage account. They have permissions to do everything on the storage account, so it is important to take care to store them securely.</p>
<p>The below code snippet shows how you can generate the required authorization values to make a request to a storage table.</p>
<pre><code>1const storageAccount = pm.variables.get(&#39;azure_storage_account&#39;);
2const accountKey = pm.variables.get(&#39;azure_storage_key&#39;);
3
4const date = new Date();
5const UTCstring = date.toUTCString();
6
7const dataToEncode = UTCstring + &quot;\n&quot; + `/${storageAccount}${pm.request.url.getPath()}`;
8
9const encodedData = unescape(encodeURIComponent(dataToEncode));
10
11var hash = CryptoJS.HmacSHA256(encodedData, CryptoJS.enc.Base64.parse(accountKey));
12var signature = hash.toString(CryptoJS.enc.Base64);
13
14var auth = &quot;SharedKeyLite &quot; + storageAccount + &quot;:&quot; + signature;
15
16pm.variables.set(&quot;header_authorization&quot;, auth);
17pm.variables.set(&quot;header_date&quot;, UTCstring);</code></pre>
<p>javascript</p>
<p>With this code snippet set as the pre-request script, you also need to set up headers to read the variables saved.</p>
<pre><code>1GET https://{{azure_storage_account}}.table.core.windows.net/MyTable()?$filter=(PartitionKey eq &#39;PartitionA&#39;)
2
3x-ms-date:{{header_date}}
4Authorization:{{header_authorization}}
5x-ms-version:2019-02-02
6Accept:application/json;odata=nometadata</code></pre>
<p>The header details above demonstrate how to configure he URL and headers of a table storage query. When you run this request, it will return a JSON list of rows that match the specified filter.</p>
<h2 id="using-shared-keys-to-authorize-to-blob-storage">Using Shared Keys to Authorize to Blob Storage</h2>
<p>You can also use shared keys to connect to blob storage. However, the script to do this is slightly more complex. It is demonstrated below and sourced from <a href="https://github.com/kamranayub/azure-storage-rest-postman">Kamran Ayub’s azure-storage-rest-postman GitHub Repository</a>.</p>
<pre><code>1// Set Date header value for authorization
2// Should be UTC GMT string
3pm.variables.set(&quot;header_date&quot;, new Date().toUTCString());
4
5// Get hash of all header-name:value
6const headers = pm.request.getHeaders({ ignoreCase: true, enabled: true });
7
8// Construct Signature value for Authorization header
9var signatureParts = [
10    pm.request.method.toUpperCase(),
11    headers[&quot;content-encoding&quot;] || &quot;&quot;,
12    headers[&quot;content-language&quot;] || &quot;&quot;,
13    headers[&quot;content-length&quot;]  || &quot;&quot;,
14//    pm.request.body ? pm.request.body.toString().length || &quot;&quot; : &quot;&quot;,
15    headers[&quot;content-md5&quot;] || &quot;&quot;,
16    headers[&quot;content-type&quot;] || &quot;&quot;,
17    headers[&quot;x-ms-date&quot;] ? &quot;&quot; : (pm.variables.get(&quot;header_date&quot;) || &quot;&quot;),
18    headers[&quot;if-modified-since&quot;] || &quot;&quot;,
19    headers[&quot;if-match&quot;] || &quot;&quot;,
20    headers[&quot;if-none-match&quot;] || &quot;&quot;,
21    headers[&quot;if-unmodified-since&quot;] || &quot;&quot;,
22    headers[&quot;range&quot;] || &quot;&quot;
23];
24
25// Construct CanonicalizedHeaders
26const canonicalHeaderNames = [];
27Object.keys(headers).forEach(key =&gt; {
28    if (key.startsWith(&quot;x-ms-&quot;)) {
29        canonicalHeaderNames.push(key);
30    }
31});
32// Sort headers lexographically by name
33canonicalHeaderNames.sort();
34
35const canonicalHeaderParts = [];
36canonicalHeaderNames.forEach(key =&gt; {
37    let value = pm.request.getHeaders({ ignoreCase: true, enabled: true })[key];
38
39    // Populate variables
40    value = pm.variables.replaceIn(value);
41
42    // Replace whitespace in value but not if its within quotes
43    if (!value.startsWith(&quot;\&quot;&quot;)) {
44        value = value.replace(/\s+/, &quot; &quot;);
45    }
46
47    canonicalHeaderParts.push(`${key}:${value}`);
48});
49
50// Add headers to signature
51signatureParts.push.apply(signatureParts, canonicalHeaderParts);
52
53// Construct CanonicalizedResource
54const canonicalResourceParts = [
55    `/${pm.variables.get(&quot;azure_storage_account&quot;)}${pm.request.url.getPath()}`
56];
57const canonicalQueryNames = [];
58pm.request.url.query.each(query =&gt; {
59    canonicalQueryNames.push(query.key.toLowerCase());
60});
61canonicalQueryNames.sort();
62canonicalQueryNames.forEach(queryName =&gt; {
63    const value = pm.request.url.query.get(queryName);
64
65    // NOTE: This does not properly explode multiple same query params&#39; values
66    // and turn them into comma-separated list
67    canonicalResourceParts.push(`${queryName}:${value}`);
68});
69// Add resource to signature
70signatureParts.push.apply(signatureParts, canonicalResourceParts);
71
72console.log(&quot;Signature Parts&quot;, signatureParts);
73
74// Now, construct signature raw string
75const signatureRaw = signatureParts.join(&quot;\n&quot;);
76
77console.log(&quot;Signature String&quot;, JSON.stringify(signatureRaw));
78
79// Hash it using HMAC-SHA256 and then encode using base64
80const storageKey = pm.variables.get(&quot;azure_storage_key&quot;);
81const signatureBytes = CryptoJS.HmacSHA256(signatureRaw, CryptoJS.enc.Base64.parse(storageKey));
82const signatureEncoded = signatureBytes.toString(CryptoJS.enc.Base64);
83
84console.log(&quot;Storage Account&quot;, pm.variables.get(&quot;azure_storage_account&quot;));
85console.log(&quot;Storage Key&quot;, storageKey);
86
87// Finally, make it available for headers
88pm.variables.set(&quot;header_authorization&quot;,
89    `SharedKey ${pm.variables.get(&quot;azure_storage_account&quot;)}:${signatureEncoded}`);</code></pre>
<p>javascript</p>
<p>Next, you need to set the request headers, similar to the table storage example above.</p>
<pre><code>1GET https://{{azure_storage_account}}.blob.core.windows.net/?restype=service&amp;comp=properties
2x-ms-date:{{header_date}}
3Authorization:{{header_authorization}}
4x-ms-version:2018-03-28</code></pre>
<p>This requests the blob metadata properties. For more details on what is optional and required in the header, read <a href="https://docs.microsoft.com/en-us/rest/api/storageservices/authorize-with-shared-key#blob-queue-and-file-services-shared-key-authorization">Microsoft’s documentation on authorizing with shared keys</a>.</p>
<h2 id="conclusion">Conclusion</h2>
<p>As demonstrated, you can use shared keys from inside Postman to query Azure storage account resources such as blobs and tables. This can be helpful for performing end-to-end API testing. You can run Postman requests on your custom APIs and verify everything is working by querying the storage account.</p>
<p>25</p>
<p><a href="https://www.pluralsight.com/product/paths"><span data-css-15b13by="" aria-hidden="false">LEARN MORE</span></a></p>
</body>
</html>
