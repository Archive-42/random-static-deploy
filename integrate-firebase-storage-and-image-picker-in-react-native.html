<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="" xml:lang="">
<head>
  <meta charset="utf-8" />
  <meta name="generator" content="pandoc" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes" />
  <title>integrate-firebase-storage-and-image-picker-in-react-native</title>
  <style>
    html {
      line-height: 1.5;
      font-family: Georgia, serif;
      font-size: 20px;
      color: #1a1a1a;
      background-color: #fdfdfd;
    }
    body {
      margin: 0 auto;
      max-width: 36em;
      padding-left: 50px;
      padding-right: 50px;
      padding-top: 50px;
      padding-bottom: 50px;
      hyphens: auto;
      overflow-wrap: break-word;
      text-rendering: optimizeLegibility;
      font-kerning: normal;
    }
    @media (max-width: 600px) {
      body {
        font-size: 0.9em;
        padding: 1em;
      }
    }
    @media print {
      body {
        background-color: transparent;
        color: black;
        font-size: 12pt;
      }
      p, h2, h3 {
        orphans: 3;
        widows: 3;
      }
      h2, h3, h4 {
        page-break-after: avoid;
      }
    }
    p {
      margin: 1em 0;
    }
    a {
      color: #1a1a1a;
    }
    a:visited {
      color: #1a1a1a;
    }
    img {
      max-width: 100%;
    }
    h1, h2, h3, h4, h5, h6 {
      margin-top: 1.4em;
    }
    h5, h6 {
      font-size: 1em;
      font-style: italic;
    }
    h6 {
      font-weight: normal;
    }
    ol, ul {
      padding-left: 1.7em;
      margin-top: 1em;
    }
    li > ol, li > ul {
      margin-top: 0;
    }
    blockquote {
      margin: 1em 0 1em 1.7em;
      padding-left: 1em;
      border-left: 2px solid #e6e6e6;
      color: #606060;
    }
    code {
      font-family: Menlo, Monaco, 'Lucida Console', Consolas, monospace;
      font-size: 85%;
      margin: 0;
    }
    pre {
      margin: 1em 0;
      overflow: auto;
    }
    pre code {
      padding: 0;
      overflow: visible;
      overflow-wrap: normal;
    }
    .sourceCode {
     background-color: transparent;
     overflow: visible;
    }
    hr {
      background-color: #1a1a1a;
      border: none;
      height: 1px;
      margin: 1em 0;
    }
    table {
      margin: 1em 0;
      border-collapse: collapse;
      width: 100%;
      overflow-x: auto;
      display: block;
      font-variant-numeric: lining-nums tabular-nums;
    }
    table caption {
      margin-bottom: 0.75em;
    }
    tbody {
      margin-top: 0.5em;
      border-top: 1px solid #1a1a1a;
      border-bottom: 1px solid #1a1a1a;
    }
    th {
      border-top: 1px solid #1a1a1a;
      padding: 0.25em 0.5em 0.25em 0.5em;
    }
    td {
      padding: 0.125em 0.5em 0.25em 0.5em;
    }
    header {
      margin-bottom: 4em;
      text-align: center;
    }
    #TOC li {
      list-style: none;
    }
    #TOC a:not(:hover) {
      text-decoration: none;
    }
    code{white-space: pre-wrap;}
    span.smallcaps{font-variant: small-caps;}
    span.underline{text-decoration: underline;}
    div.column{display: inline-block; vertical-align: top; width: 50%;}
    div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
    ul.task-list{list-style: none;}
    .display.math{display: block; text-align: center; margin: 0.5rem auto;}
  </style>
  <!--[if lt IE 9]>
    <script src="//cdnjs.cloudflare.com/ajax/libs/html5shiv/3.7.3/html5shiv-printshiv.min.js"></script>
  <![endif]-->
</head>
<body>
<p><span data-css-15b13by="" aria-hidden="false">Get started</span></p>
<p><span data-css-15b13by="" aria-hidden="false">Log in</span></p>
<p><img src="../../pluralsight.imgix.net/author/lg/d87e74d1-8e02-494a-9052-eb43fe48f3ac.jpg" alt="Author avatar" class="jsx-3841407315" /></p>
<p>Pavneet Singh</p>
<h1 id="integrate-firebase-storage-and-image-picker-in-react-native">Integrate Firebase Storage and Image Picker in React Native</h1>
<h3 id="pavneet-singh">Pavneet Singh</h3>
<ul>
<li><p>Oct 17, 2020</p></li>
<li><p>12 Min read</p></li>
<li><p>5,115 Views</p></li>
<li><p>Oct 17, 2020</p></li>
<li><p><span class="jsx-3759398792" itemprop="timeRequired">12 Min</span> read</p></li>
<li><p>5,115 Views</p></li>
</ul>
<p><span class="jsx-3759398792"></span></p>
<p><span data-css-1997kh1="">Web Development</span></p>
<p><span class="jsx-3759398792"></span></p>
<p><span data-css-1997kh1="">Front End Web Development</span></p>
<p><span class="jsx-3759398792"></span></p>
<p><span data-css-1997kh1="">Client-side Frameworks</span></p>
<p><span class="jsx-3759398792"></span></p>
<p><span data-css-1997kh1="">React</span></p>
<p>Introduction</p>
<p>9</p>
<ul>
<li><a href="#module-introduction" class="menu-link">Introduction</a></li>
<li><a href="#module-settingupfirebasestoragedependencies" class="menu-link">Setting Up Firebase Storage Dependencies</a></li>
<li><a href="#module-settingupfirebasestorageinconsole" class="menu-link">Setting Up Firebase Storage in Console</a></li>
<li><a href="#module-settingupimagepicker" class="menu-link">Setting Up Image Picker</a></li>
<li><a href="#module-implementimagepicker" class="menu-link">Implement Image Picker</a></li>
<li><a href="#module-conclusion" class="menu-link">Conclusion</a></li>
<li><a href="#top" class="menu-link">Top</a></li>
</ul>
<h2 id="introduction">Introduction</h2>
<p>The Firebase storage service is used to store media content for all the Firebase apps (Android, iOS, and web) under a linked Firebase project. The Firebase storage service is built upon <a href="https://cloud.google.com/storage">Google Cloud Storage</a>, which allows web apps to access the content of storage directly. The data is stored in Google Cloud Storage buckets, which are nothing but a namespace to manage data and access controls. The storage service can be added with a separate NPM dependency. The images can be fetched from the device or camera using the <span class="jsx-3120878690"><code>react-native-image-picker</code></span> NPM module.</p>
<p>This guide covers the implementation of Firebase storage and image picker module to fetch and store an image from the device to a Firebase storage bucket. Follow these other guides to complete the implementation:</p>
<ol type="1">
<li><a href="https://app.pluralsight.com/guides/setting-up-a-firebase-project-for-react-native">Setting Up a Firebase Project for React Native</a></li>
<li>Integrate Firebase Storage and Image Picker in React Native (current guide)</li>
<li><a href="https://app.pluralsight.com/guides/upload-images-to-firebase-storage-in-react-native">Upload Images to Firebase Storage in React Native</a></li>
</ol>
<p>The optimized codebase is available on <a href="https://github.com/Pavneet-Sing/RNFirebaseStorage">RNFirebaseStorage</a> repository.</p>
<h2 id="setting-up-firebase-storage-dependencies">Setting Up Firebase Storage Dependencies</h2>
<p>Every Firebase service requires a specific NPM module to communicate with the Firebase server apps. The Firebase storage APIs can be integrated using the <span class="jsx-3120878690"><code>react-native-firebase/storage</code></span> NPM module:</p>
<pre><code>1# Install the storage module
2npm install @react-native-firebase/storage
3
4# setup iOS project
5cd ios &amp;&amp; pod install --repo-update &amp;&amp; cd ..</code></pre>
<p>bash</p>
<p>The commands will install the Firebase storage module. Install the iOS <span class="jsx-3120878690"><code>pod</code></span> dependency for the Firebase storage.</p>
<blockquote>
<p><span class="jsx-3120878690"><code>@react-native-firebase/app</code></span> NPM modules is required to use most of the Firebase NPM modules.</p>
</blockquote>
<h2 id="setting-up-firebase-storage-in-console">Setting Up Firebase Storage in Console</h2>
<p>By default, Firebase creates a storage bucket to store the media content and name the bucket using the Firebase project ID as <span class="jsx-3120878690"><code>gs://firebase-project-id.appspot.com</code></span>.</p>
<p>Create a default storage bucket in the Firebase project:</p>
<ol type="1">
<li>Select the <strong>Storage</strong> option form the left panel and click on <strong>Get Started</strong>.</li>
<li>Continue with the onboarding flow with the <strong>next</strong> option and select any storage location near to your location. <embed src="../../pluralsight2.imgix.net/guides/16cd3e4e-971f-41ce-84fd-5559e9323093_setup_bucket_server.html" /></li>
</ol>
<p>Firebase protects the storage content from unauthorized access by using the <span class="jsx-3120878690"><code>allow read, write: if request.auth !=                                       null;</code></span> rule.</p>
<ol type="1">
<li><p>Choose any cloud storage location near to your current location and click <strong>Done</strong>.</p></li>
<li><p>Go to the <strong>Rules</strong> tab and change the rules for the public access:</p>
<p>1rules_version = ‘2’; 2service firebase.storage { 3 match /b/{bucket}/o { 4 match /{allPaths=**} { 5 allow read, write; 6 } 7 }</p></li>
</ol>
<p>This will enable public access to the Firebase storage bucket to every user without integrating the Firebase authentication service.</p>
<blockquote>
<p>Do not use the public access rule <span class="jsx-3120878690"><code>allow read, write</code></span>; in production, it can cause data protection issues.</p>
</blockquote>
<h2 id="setting-up-image-picker">Setting Up Image Picker</h2>
<p>The images on Android or iOS devices are managed via different built-in apps (Gallery or Photos), and these images can be accessed via a specific path (URI for iOS) value. The <a href="https://github.com/react-native-community/react-native-image-picker/tree/fb78e6045046ba4cfa621c36172db43c6f70a44c">react-native-image-picker</a> module provides React Native-specific APIs to get the path/URI of an image on the underlying native device. Follow the below steps to install and configure the image picker:</p>
<h3 id="install-image-picker">Install Image Picker</h3>
<p>Execute the below commands to install the image picker module and iOS <span class="jsx-3120878690"><code>pod</code></span> dependency</p>
<pre><code>1npm install react-native-image-picker
2cd ios &amp;&amp; pod install &amp;&amp; cd ..</code></pre>
<p>sh</p>
<h3 id="add-permission">Add Permission</h3>
<p>Both Android and iOS follow the permission model to inform the user about the resource used by an app, so these permissions should be added in configurations files in the native projects.</p>
<ul>
<li><p><strong>Add Android Permission</strong>: Add the required permissions in the <span class="jsx-3120878690"><code>RNFirebaseStorage/android/app/src/main/AndroidManifest.xml</code></span> file to get the camera and storage access on an android device:</p>
<p>1<uses-permission android:name="android.permission.CAMERA" /> 2<uses-permission android:name="android.permission.WRITE_EXTERNAL_STORAGE"/></p></li>
</ul>
<p>xml</p>
<ul>
<li><p><strong>Add iOS permissions</strong>: The below permissions (key-string pairs) should be added in the <span class="jsx-3120878690"><code>RNFirebaseStorage/ios/RNFirebaseStorage/info.plist</code></span> file to get access to photos, camera, and photo storage. Open the <span class="jsx-3120878690"><code>info.plist</code></span> file with any text editor and then copy and paste all three key-string pairs from the below snippet. In Xcode, right-click on the <span class="jsx-3120878690"><code>info.plist</code></span> file, choose the <strong>Opens As</strong> option, and then <span class="jsx-3120878690"><code>Source Code</code></span> option:</p>
<p>1<plist version="1.0"> 2 <dict> 3 <key>NSPhotoLibraryUsageDescription</key> 4 <string><span class="math inline">(<em>P</em><em>R</em><em>O</em><em>D</em><em>U</em><em>C</em><em>T</em><sub><em>N</em></sub><em>A</em><em>M</em><em>E</em>)<em>w</em><em>o</em><em>u</em><em>l</em><em>d</em><em>l</em><em>i</em><em>k</em><em>e</em><em>a</em><em>c</em><em>c</em><em>e</em><em>s</em><em>s</em><em>t</em><em>o</em><em>y</em><em>o</em><em>u</em><em>r</em><em>p</em><em>h</em><em>o</em><em>t</em><em>o</em><em>g</em><em>a</em><em>l</em><em>l</em><em>e</em><em>r</em><em>y</em> &lt; /<em>s</em><em>t</em><em>r</em><em>i</em><em>n</em><em>g</em> &gt; 5 &lt; <em>k</em><em>e</em><em>y</em> &gt; <em>N</em><em>S</em><em>C</em><em>a</em><em>m</em><em>e</em><em>r</em><em>a</em><em>U</em><em>s</em><em>a</em><em>g</em><em>e</em><em>D</em><em>e</em><em>s</em><em>c</em><em>r</em><em>i</em><em>p</em><em>t</em><em>i</em><em>o</em><em>n</em> &lt; /<em>k</em><em>e</em><em>y</em> &gt; 6 &lt; <em>s</em><em>t</em><em>r</em><em>i</em><em>n</em><em>g</em>&gt;</span>(PRODUCT_NAME) would like to use your camera</string> 7 <key>NSPhotoLibraryAddUsageDescription</key> 8 <string>$(PRODUCT_NAME) would like to save photos to your photo gallery</string> 9 </dict> 10</plist></p></li>
</ul>
<p>xml</p>
<p>Alternately, this can be done in the Xcode UI by using the <strong>+</strong> button to add key and string values: <embed src="../../pluralsight2.imgix.net/guides/41e8dd24-d0d6-4906-9af5-c92c6e5c05c4_14_ios_camera_permission.html" /></p>
<p>Optionally, clean the Android and iOS projects:</p>
<pre><code>1#android
2cd android &amp;&amp; ./gradlew clean &amp;&amp; cd ..
3#iOS
4cd ios &amp;&amp; xcodebuild clean &amp;&amp; cd ..</code></pre>
<p>sh</p>
<h2 id="implement-image-picker">Implement Image Picker</h2>
<p>The image picker can get the image either from the photo gallery or camera. The UI of the image picker dialog can also be customized using the <span class="jsx-3120878690"><code>Options</code></span> object that can be passed as the first parameter to <span class="jsx-3120878690"><code>showImagePicker</code></span> function call. The second parameter of <span class="jsx-3120878690"><code>showImagePicker</code></span> is a callback function that will be called with a <span class="jsx-3120878690"><code>response</code></span> object which contains the details about the selected image:</p>
<pre><code>1chooseFile = () =&gt; {
2    this.setState({ status: &#39;&#39; });
3    var options = {
4        title: &#39;Select Image&#39;,
5        storageOptions: {
6            skipBackup: true, // do not backup to iCloud
7            path: &#39;images&#39;, // store camera images under Pictures/images for android and Documents/images for iOS
8        },
9    };
10    ImagePicker.showImagePicker(options, response =&gt; {
11        if (response.didCancel) {
12            console.log(&#39;User cancelled image picker&#39;, storage());
13        } else if (response.error) {
14            console.log(&#39;ImagePicker Error: &#39;, response.error);
15        } else if (response.customButton) {
16            console.log(&#39;User tapped custom button: &#39;, response.customButton);
17        } else {
18            let path = this.getPlatformPath(response).value;
19        }
20    });
21};
22
23/**
24 * Get platform specific value from response
25 */
26getPlatformPath({ path, uri }) {
27    return Platform.select({
28        android: { &quot;value&quot;: path },
29        ios: { &quot;value&quot;: uri }
30    })
31}</code></pre>
<p>JSX</p>
<p>The <span class="jsx-3120878690"><code>storageOptions</code></span> object defined the <span class="jsx-3120878690"><code>path</code></span> to store clicked images under the <span class="jsx-3120878690"><code>Document/Images</code></span> for iOS and <span class="jsx-3120878690"><code>Pictures/images</code></span> for Android. A <span class="jsx-3120878690"><code>skipBackup: true</code></span> property will instruct iOS to skip the iCloud image backup for camera images.</p>
<p>Here’s the complete code to trigger <span class="jsx-3120878690"><code>chooseFile</code></span> function to fetch and display the selected image on screen:</p>
<pre><code>1// App.js
2/**
3 * @author Pavneet Singh
4 */
5
6import React from &quot;react&quot;;
7import {
8    StyleSheet,
9    View,
10    Button,
11    Image,
12    ActivityIndicator,
13    Platform,
14    SafeAreaView,
15    Text,
16} from &quot;react-native&quot;;
17import storage from &#39;@react-native-firebase/storage&#39;;
18import ImagePicker from &#39;react-native-image-picker&#39;;
19export default class App extends React.Component {
20
21    state = {
22        // placeholder image
23        imagePath: require(&quot;./img/default.jpg&quot;)
24    }
25
26    chooseFile = () =&gt; {
27        var options = {
28            title: &#39;Select Image&#39;,
29            storageOptions: {
30                skipBackup: true, // do not backup to iCloud
31                path: &#39;images&#39;, // store camera images under Pictures/images for android and Documents/images for iOS
32            },
33        };
34        ImagePicker.showImagePicker(options, response =&gt; {
35            if (response.didCancel) {
36                console.log(&#39;User cancelled image picker&#39;, storage());
37            } else if (response.error) {
38                console.log(&#39;ImagePicker Error: &#39;, response.error);
39            } else if (response.customButton) {
40                console.log(&#39;User tapped custom button: &#39;, response.customButton);
41            } else {
42                let path = this.getPlatformPath(response).value;
43                let fileName = this.getFileName(response.fileName, path);
44                this.setState({ imagePath: path });
45            }
46        });
47    };
48
49    /**
50     * Get the file name and handle the invalid null case
51     */
52    getFileName(name, path) {
53        if (name != null) { return name; }
54
55        if (Platform.OS === &quot;ios&quot;) {
56            path = &quot;~&quot; + path.substring(path.indexOf(&quot;/Documents&quot;));
57        }
58        return path.split(&quot;/&quot;).pop();
59    }
60
61    /**
62     * Get platform specific value from response
63     */
64    getPlatformPath({ path, uri }) {
65        return Platform.select({
66            android: { &quot;value&quot;: path },
67            ios: { &quot;value&quot;: uri }
68        })
69    }
70
71    /**
72     * Get platform-specific Uri with the required format
73     */
74    getPlatformURI(imagePath) {
75        let imgSource = imagePath;
76        if (isNaN(imagePath)) {
77            imgSource = { uri: this.state.imagePath };
78            if (Platform.OS == &#39;android&#39;) {
79                imgSource.uri = &quot;file:///&quot; + imgSource.uri;
80            }
81        }
82        return imgSource
83    }
84
85    render() {
86        let { imagePath } = this.state;
87        let imgSource = this.getPlatformURI(imagePath)
88        return (
89            &lt;SafeAreaView style={styles.container}&gt;
90                &lt;View style={styles.imgContainer}&gt;
91                    &lt;Image style={styles.uploadImage} source={imgSource} /&gt;
92                    &lt;View style={styles.eightyWidthStyle} &gt;
93                        &lt;Button title={&#39;Upload Image&#39;} onPress={this.chooseFile}&gt;&lt;/Button&gt;
94                    &lt;/View&gt;
95                &lt;/View&gt;
96            &lt;/SafeAreaView&gt;
97        )
98    }
99}
100
101const styles = StyleSheet.create({
102    container: {
103        flex: 1,
104        width: &#39;100%&#39;,
105        height: &#39;100%&#39;,
106        backgroundColor: &#39;#e6e6fa&#39;,
107    },
108    imgContainer: {
109        alignItems: &#39;center&#39;,
110        justifyContent: &#39;center&#39;,
111        position: &#39;absolute&#39;,
112        width: &#39;100%&#39;,
113        height: &#39;100%&#39;
114    },
115    eightyWidthStyle: {
116        width: &#39;80%&#39;,
117        margin: 2,
118    },
119    uploadImage: {
120        width: &#39;80%&#39;,
121        height: 300,
122    },
123});</code></pre>
<p>jsx</p>
<p>A successful image selection will trigger the <span class="jsx-3120878690"><code>else</code></span> case in <span class="jsx-3120878690"><code>chooseFile</code></span> method and provide the image details via the <span class="jsx-3120878690"><code>response</code></span> object. The <span class="jsx-3120878690"><code>getPlatformPath</code></span> function will return a platform-specific path/URI value that is being stored in the <span class="jsx-3120878690"><code>state</code></span> object to update the image on the screen.</p>
<h2 id="conclusion">Conclusion</h2>
<p>Firebase services like storage, database, and Firestore can use the Firebase rules to validate the data and users. Firebase storage is built upon the Google Cloud Storage service so it can store petabytes of data. The <span class="jsx-3120878690"><code>image-picker</code></span> module offers a quick way to fetch images from the devices. It also supports functions like <span class="jsx-3120878690"><code>launchCamera</code></span> and <span class="jsx-3120878690"><code>launchImageLibrary</code></span> to use a specific image source. Follow <a href="https://app.pluralsight.com/guides/upload-images-to-firebase-storage-in-react-native">this guide</a> to learn about uploading a selected image to the Firebase storage bucket. Happy coding!</p>
<p>9</p>
<p><a href="https://www.pluralsight.com/product/paths"><span data-css-15b13by="" aria-hidden="false">LEARN MORE</span></a></p>
</body>
</html>
